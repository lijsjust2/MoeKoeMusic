# GitHub Actions Dockeræ„å»ºä¸éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºDockeré•œåƒï¼Œå¹¶åœ¨å…¶ä»–æœºå™¨ä¸Šè¿è¡Œè¯¥å®¹å™¨æ¥å¯åŠ¨MoeKoeMusicé¡¹ç›®ã€‚

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

- **è‡ªåŠ¨æ„å»º**ï¼šæ¯æ¬¡æ¨é€ä»£ç åˆ°mainåˆ†æ”¯æˆ–åˆ›å»ºtagæ—¶è‡ªåŠ¨è§¦å‘Dockeré•œåƒæ„å»º
- **å¤šå¹³å°æ”¯æŒ**ï¼šæ”¯æŒæ„å»ºå¤šç§CPUæ¶æ„çš„Dockeré•œåƒ
- **è‡ªåŠ¨æ¨é€**ï¼šæ„å»ºæˆåŠŸåè‡ªåŠ¨æ¨é€åˆ°Docker Hub
- **å®¹å™¨éƒ¨ç½²**ï¼šæä¾›åœ¨ä»»ä½•æ”¯æŒDockerçš„æœºå™¨ä¸Šä¸€é”®è¿è¡Œçš„å‘½ä»¤

## ğŸ”§ å·²é…ç½®å†…å®¹

é¡¹ç›®ä¸­å·²ç»é…ç½®å¥½äº†ä»¥ä¸‹å†…å®¹ï¼š

1. **Dockerfile**ï¼šç”¨äºå®šä¹‰Dockeré•œåƒçš„æ„å»ºæ­¥éª¤
2. **GitHub Actionså·¥ä½œæµ**ï¼šä½äº`.github/workflows/docker-build.yml`ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ„å»ºDockeré•œåƒ
3. **package.json**ï¼šåŒ…å«æ­£ç¡®çš„é¡¹ç›®ä¿¡æ¯å’Œæ„å»ºè„šæœ¬

## ğŸš€ ä½¿ç”¨æ­¥éª¤

### 1. åœ¨GitHubä»“åº“ä¸­è®¾ç½®å¯†é’¥

ä¸ºäº†è®©GitHub Actionsèƒ½å¤Ÿæ¨é€åˆ°Docker Hubï¼Œéœ€è¦åœ¨GitHubä»“åº“è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹å¯†é’¥ï¼š

1. æ‰“å¼€GitHubä»“åº“é¡µé¢ï¼Œç‚¹å‡»å³ä¸Šè§’çš„ã€ŒSettingsã€
2. é€‰æ‹©å·¦ä¾§èœå•ä¸­çš„ã€ŒSecrets and variablesã€â†’ã€ŒActionsã€
3. ç‚¹å‡»ã€ŒNew repository secretã€æ·»åŠ ä»¥ä¸‹å¯†é’¥ï¼š

   - `DOCKER_HUB_USERNAME`ï¼šä½ çš„Docker Hubç”¨æˆ·å
   - `DOCKER_HUB_TOKEN`ï¼šä½ çš„Docker Hubè®¿é—®ä»¤ç‰Œï¼ˆåœ¨Docker Hubä¸ªäººè®¾ç½®ä¸­åˆ›å»ºï¼‰

### 2. è§¦å‘Dockeré•œåƒæ„å»º

è®¾ç½®å¥½å¯†é’¥åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è§¦å‘æ„å»ºï¼š

- å°†ä»£ç æ¨é€åˆ°mainåˆ†æ”¯ï¼š`git push origin main`
- åˆ›å»ºå¹¶æ¨é€tagï¼š`git tag v1.0.0 && git push origin v1.0.0`

GitHub Actionsä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
1. æ£€å‡ºä»£ç 
2. è®¾ç½®æ„å»ºç¯å¢ƒï¼ˆQEMUã€Docker Buildxï¼‰
3. ç™»å½•Docker Hub
4. æ„å»ºDockeré•œåƒ
5. æ¨é€åˆ°Docker Hub

### 3. åœ¨å…¶ä»–æœºå™¨ä¸Šè¿è¡Œå®¹å™¨

é•œåƒæ„å»ºå®Œæˆåï¼Œå¯ä»¥åœ¨ä»»ä½•å®‰è£…äº†Dockerçš„æœºå™¨ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨å®¹å™¨ï¼š

```bash
docker run -d --name MoeKoeMusic -p 8080:8080 lijsjust2/moekoemusic:latest
```

å‚æ•°è¯´æ˜ï¼š
- `-d`ï¼šåå°è¿è¡Œå®¹å™¨
- `--name MoeKoeMusic`ï¼šè®¾ç½®å®¹å™¨åç§°ä¸ºMoeKoeMusic
- `-p 8080:8080`ï¼šå°†å®¹å™¨å†…çš„8080ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„8080ç«¯å£
- `lijsjust2/moekoemusic:latest`ï¼šä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„é•œåƒ

### 4. è®¿é—®åº”ç”¨

å®¹å™¨å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®MoeKoeMusicï¼š

```
http://[æœºå™¨IPåœ°å€]:8080
```

å¦‚æœæ˜¯åœ¨æœ¬åœ°è¿è¡Œï¼Œåˆ™ä¸ºï¼š

```
http://localhost:8080
```

## âš™ï¸ è‡ªå®šä¹‰é…ç½®

### è‡ªå®šä¹‰ç«¯å£æ˜ å°„

å¦‚æœéœ€è¦ä½¿ç”¨ä¸åŒçš„ç«¯å£ï¼Œå¯ä»¥ä¿®æ”¹ç«¯å£æ˜ å°„å‚æ•°ï¼š

```bash
docker run -d --name MoeKoeMusic -p 80:8080 lijsjust2/moekoemusic:latest
```

è¿™å°†æŠŠå®¹å™¨çš„8080ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„80ç«¯å£ã€‚

### æŒä¹…åŒ–æ•°æ®

å¦‚æœä½ æƒ³æŒä¹…åŒ–å­˜å‚¨åº”ç”¨æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨Dockerå·ï¼š

```bash
docker run -d --name MoeKoeMusic -p 8080:8080 -v moekoe-data:/app/data lijsjust2/moekoemusic:latest
```

è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º`moekoe-data`çš„æ•°æ®å·ï¼Œç”¨äºæŒä¹…åŒ–å­˜å‚¨åº”ç”¨æ•°æ®ã€‚

### ä½¿ç”¨docker-compose

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨docker-composeæ¥ç®¡ç†å®¹å™¨ï¼Œåˆ›å»ºä¸€ä¸ª`docker-compose.yml`æ–‡ä»¶ï¼š

```yaml
version: '3'

services:
  moekoe-music:
    image: lijsjust2/moekoemusic:latest
    container_name: MoeKoeMusic
    ports:
      - "8080:8080"
    volumes:
      - moekoe-data:/app/data
    restart: unless-stopped

volumes:
  moekoe-data:
```

ç„¶åè¿è¡Œï¼š

```bash
docker-compose up -d
```

## ğŸ” æŸ¥çœ‹æ„å»ºçŠ¶æ€

å¯ä»¥åœ¨GitHubä»“åº“é¡µé¢çš„ã€ŒActionsã€é€‰é¡¹å¡ä¸­æŸ¥çœ‹Dockeré•œåƒçš„æ„å»ºçŠ¶æ€å’Œæ—¥å¿—ã€‚

## ğŸ“ æ³¨æ„äº‹é¡¹

1. ç¡®ä¿ä½ çš„Docker Hubè´¦å·æœ‰è¶³å¤Ÿçš„æƒé™æ¨é€é•œåƒ
2. ç¬¬ä¸€æ¬¡æ„å»ºå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…
3. å¦‚æœæ„å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥GitHub Actionsæ—¥å¿—ä»¥è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
4. é•œåƒæ„å»ºå®Œæˆåï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´æ‰èƒ½åœ¨Docker Hubä¸Šå®Œå…¨å¯ç”¨
5. è¿è¡Œå®¹å™¨çš„æœºå™¨éœ€è¦æœ‰è¶³å¤Ÿçš„èµ„æºï¼ˆå»ºè®®è‡³å°‘2GBå†…å­˜ï¼‰

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å®¹å™¨å¯åŠ¨å¤±è´¥

å¦‚æœå®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š

```bash
docker logs MoeKoeMusic
```

### è®¿é—®åº”ç”¨è¶…æ—¶

å¦‚æœæ— æ³•è®¿é—®åº”ç”¨ï¼Œè¯·æ£€æŸ¥ï¼š
1. å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š`docker ps`
2. ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¡®ï¼š`docker port MoeKoeMusic`
3. ä¸»æœºé˜²ç«å¢™æ˜¯å¦å…è®¸è®¿é—®æŒ‡å®šç«¯å£

### GitHub Actionsæ„å»ºå¤±è´¥

å¸¸è§çš„æ„å»ºå¤±è´¥åŸå› ï¼š
1. Docker Hubå‡­è¯ä¸æ­£ç¡®
2. ä»£ç ä¸­æœ‰é”™è¯¯å¯¼è‡´æ„å»ºå¤±è´¥
3. Docker Hubé€Ÿç‡é™åˆ¶é—®é¢˜

è¯·æŸ¥çœ‹GitHub Actionsæ—¥å¿—ä»¥è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ç›¸åº”åœ°è°ƒæ•´é…ç½®ã€‚

## ğŸ“š æ›´å¤šèµ„æº

- [Dockerå®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [GitHub Actionså®˜æ–¹æ–‡æ¡£](https://docs.github.com/en/actions)
- [Docker Hubæ–‡æ¡£](https://docs.docker.com/docker-hub/)